<!DOCTYPE html>
<!-- saved from url=(0045)https://iacopoapps.appspot.com/hopalongwebgl/ -->
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Barry Martin's Hopalong Orbits Visualizer - WebGL Experiment</title>

    <meta property="title" content="Barry Martin&#39;s Hopalong Orbits Visualizer - WebGL Experiment">
    <meta property="description"
        content="An interactive flight through attractor orbits generated using Barry Martin&#39;s Hopalong formula.">

    <meta property="og:title" content="Barry Martin&#39;s Hopalong Orbits Visualizer - WebGL Experiment">
    <meta property="og:image" content="http://iacopoapps.appspot.com/hopalongwebgl/image.jpg">
    <meta property="og:description"
        content="An interactive flight through attractor orbits generated using Barry Martin&#39;s Hopalong formula.">

    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            background-color: #000000;
            margin: 0px;
            overflow: hidden;
            font-family: Monospace;
            font-size: 13px;
            text-align: center;
            font-weight: bold;
            text-align: center;
        }

        a {
            color: #ffffaa;
        }

        #info {
            color: #fff;
            position: absolute;
            top: 0px;
            width: 100%;
            padding: 5px;
            z-index: 100;
        }

        #fb {
            position: absolute;
            bottom: 10px;
            left: 10px;
            z-index: 100;
        }

        #tweet {
            position: absolute;
            bottom: 7px;
            left: 90px;
            z-index: 100;
        }

        #plusone {
            position: absolute;
            bottom: 7px;
            left: 157px;
            z-index: 100;
        }

        #chaosnebula {
            position: absolute;
            padding: 5px;
            bottom: 0px;
            right: 5px;
            z-index: 100;
            color: #fff;
        }

        #about {
            text-align: left;
            z-index: 110;
            position: absolute;
            top: 25px;
            left: 5px;
            display: none;
            width: 400px;
            color: #fff;
            background: #121212;
            opacity: 0.8;
            border-radius: 20px;
            padding: 16px
        }

        #aboutlink {
            z-index: 110;
            position: absolute;
            top: 5px;
            left: 5px;
        }
    </style>

    <script src="./assets/all.js" async="" crossorigin="anonymous"></script>
    <script id="facebook-jssdk" src="./assets/all(1).js"></script>
    <script type="text/javascript" async="" src="./assets/ga.js"></script>
    <script async="" src="./assets/gtm.js"></script>
    <script type="text/javascript">
        function recordOutboundLink(link, category, action) {
            _gat._getTrackerByName()._trackEvent(category, action);
            setTimeout('document.location = "' + link.href + '"', 100);
        }
    </script>
    <style type="text/css"
        data-fbcssmodules="css:fb.css.base css:fb.css.dialog css:fb.css.iframewidget css:fb.css.customer_chat_plugin_iframe">
        .fb_hidden {
            position: absolute;
            top: -10000px;
            z-index: 10001
        }

        .fb_reposition {
            overflow: hidden;
            position: relative
        }

        .fb_invisible {
            display: none
        }

        .fb_reset {
            background: none;
            border: 0;
            border-spacing: 0;
            color: #000;
            cursor: auto;
            direction: ltr;
            font-family: "lucida grande", tahoma, verdana, arial, sans-serif;
            font-size: 11px;
            font-style: normal;
            font-variant: normal;
            font-weight: normal;
            letter-spacing: normal;
            line-height: 1;
            margin: 0;
            overflow: visible;
            padding: 0;
            text-align: left;
            text-decoration: none;
            text-indent: 0;
            text-shadow: none;
            text-transform: none;
            visibility: visible;
            white-space: normal;
            word-spacing: normal
        }

        .fb_reset>div {
            overflow: hidden
        }

        @keyframes fb_transform {
            from {
                opacity: 0;
                transform: scale(.95)
            }

            to {
                opacity: 1;
                transform: scale(1)
            }
        }

        .fb_animate {
            animation: fb_transform .3s forwards
        }

        .fb_dialog {
            background: rgba(82, 82, 82, .7);
            position: absolute;
            top: -10000px;
            z-index: 10001
        }

        .fb_dialog_advanced {
            border-radius: 8px;
            padding: 10px
        }

        .fb_dialog_content {
            background: #fff;
            color: #373737
        }

        .fb_dialog_close_icon {
            background: url(https://z-p3-static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;
            cursor: pointer;
            display: block;
            height: 15px;
            position: absolute;
            right: 18px;
            top: 17px;
            width: 15px
        }

        .fb_dialog_mobile .fb_dialog_close_icon {
            left: 5px;
            right: auto;
            top: 5px
        }

        .fb_dialog_padding {
            background-color: transparent;
            position: absolute;
            width: 1px;
            z-index: -1
        }

        .fb_dialog_close_icon:hover {
            background: url(https://z-p3-static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent
        }

        .fb_dialog_close_icon:active {
            background: url(https://z-p3-static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent
        }

        .fb_dialog_iframe {
            line-height: 0
        }

        .fb_dialog_content .dialog_title {
            background: #6d84b4;
            border: 1px solid #365899;
            color: #fff;
            font-size: 14px;
            font-weight: bold;
            margin: 0
        }

        .fb_dialog_content .dialog_title>span {
            background: url(https://z-p3-static.xx.fbcdn.net/rsrc.php/v3/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;
            float: left;
            padding: 5px 0 7px 26px
        }

        body.fb_hidden {
            height: 100%;
            left: 0;
            margin: 0;
            overflow: visible;
            position: absolute;
            top: -10000px;
            transform: none;
            width: 100%
        }

        .fb_dialog.fb_dialog_mobile.loading {
            background: url(https://z-p3-static.xx.fbcdn.net/rsrc.php/v3/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;
            min-height: 100%;
            min-width: 100%;
            overflow: hidden;
            position: absolute;
            top: 0;
            z-index: 10001
        }

        .fb_dialog.fb_dialog_mobile.loading.centered {
            background: none;
            height: auto;
            min-height: initial;
            min-width: initial;
            width: auto
        }

        .fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner {
            width: 100%
        }

        .fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content {
            background: none
        }

        .loading.centered #fb_dialog_loader_close {
            clear: both;
            color: #fff;
            display: block;
            font-size: 18px;
            padding-top: 20px
        }

        #fb-root #fb_dialog_ipad_overlay {
            background: rgba(0, 0, 0, .4);
            bottom: 0;
            left: 0;
            min-height: 100%;
            position: absolute;
            right: 0;
            top: 0;
            width: 100%;
            z-index: 10000
        }

        #fb-root #fb_dialog_ipad_overlay.hidden {
            display: none
        }

        .fb_dialog.fb_dialog_mobile.loading iframe {
            visibility: hidden
        }

        .fb_dialog_mobile .fb_dialog_iframe {
            position: sticky;
            top: 0
        }

        .fb_dialog_content .dialog_header {
            background: linear-gradient(from(#738aba), to(#2c4987));
            border-bottom: 1px solid;
            border-color: #043b87;
            box-shadow: white 0 1px 1px -1px inset;
            color: #fff;
            font: bold 14px Helvetica, sans-serif;
            text-overflow: ellipsis;
            text-shadow: rgba(0, 30, 84, .296875) 0 -1px 0;
            vertical-align: middle;
            white-space: nowrap
        }

        .fb_dialog_content .dialog_header table {
            height: 43px;
            width: 100%
        }

        .fb_dialog_content .dialog_header td.header_left {
            font-size: 12px;
            padding-left: 5px;
            vertical-align: middle;
            width: 60px
        }

        .fb_dialog_content .dialog_header td.header_right {
            font-size: 12px;
            padding-right: 5px;
            vertical-align: middle;
            width: 60px
        }

        .fb_dialog_content .touchable_button {
            background: linear-gradient(from(#4267B2), to(#2a4887));
            background-clip: padding-box;
            border: 1px solid #29487d;
            border-radius: 3px;
            display: inline-block;
            line-height: 18px;
            margin-top: 3px;
            max-width: 85px;
            padding: 4px 12px;
            position: relative
        }

        .fb_dialog_content .dialog_header .touchable_button input {
            background: none;
            border: none;
            color: #fff;
            font: bold 12px Helvetica, sans-serif;
            margin: 2px -12px;
            padding: 2px 6px 3px 6px;
            text-shadow: rgba(0, 30, 84, .296875) 0 -1px 0
        }

        .fb_dialog_content .dialog_header .header_center {
            color: #fff;
            font-size: 16px;
            font-weight: bold;
            line-height: 18px;
            text-align: center;
            vertical-align: middle
        }

        .fb_dialog_content .dialog_content {
            background: url(https://z-p3-static.xx.fbcdn.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;
            border: 1px solid #4a4a4a;
            border-bottom: 0;
            border-top: 0;
            height: 150px
        }

        .fb_dialog_content .dialog_footer {
            background: #f5f6f7;
            border: 1px solid #4a4a4a;
            border-top-color: #ccc;
            height: 40px
        }

        #fb_dialog_loader_close {
            float: left
        }

        .fb_dialog.fb_dialog_mobile .fb_dialog_close_icon {
            visibility: hidden
        }

        #fb_dialog_loader_spinner {
            animation: rotateSpinner 1.2s linear infinite;
            background-color: transparent;
            background-image: url(https://z-p3-static.xx.fbcdn.net/rsrc.php/v3/yD/r/t-wz8gw1xG1.png);
            background-position: 50% 50%;
            background-repeat: no-repeat;
            height: 24px;
            width: 24px
        }

        @keyframes rotateSpinner {
            0% {
                transform: rotate(0deg)
            }

            100% {
                transform: rotate(360deg)
            }
        }

        .fb_iframe_widget {
            display: inline-block;
            position: relative
        }

        .fb_iframe_widget span {
            display: inline-block;
            position: relative;
            text-align: justify
        }

        .fb_iframe_widget iframe {
            position: absolute
        }

        .fb_iframe_widget_fluid_desktop,
        .fb_iframe_widget_fluid_desktop span,
        .fb_iframe_widget_fluid_desktop iframe {
            max-width: 100%
        }

        .fb_iframe_widget_fluid_desktop iframe {
            min-width: 220px;
            position: relative
        }

        .fb_iframe_widget_lift {
            z-index: 1
        }

        .fb_iframe_widget_fluid {
            display: inline
        }

        .fb_iframe_widget_fluid span {
            width: 100%
        }

        .fb_mpn_mobile_landing_page_slide_out {
            animation-duration: 200ms;
            animation-name: fb_mpn_landing_page_slide_out;
            transition-timing-function: ease-in
        }

        .fb_mpn_mobile_landing_page_slide_out_from_left {
            animation-duration: 200ms;
            animation-name: fb_mpn_landing_page_slide_out_from_left;
            transition-timing-function: ease-in
        }

        .fb_mpn_mobile_landing_page_slide_up {
            animation-duration: 500ms;
            animation-name: fb_mpn_landing_page_slide_up;
            transition-timing-function: ease-in
        }

        .fb_mpn_mobile_bounce_in {
            animation-duration: 300ms;
            animation-name: fb_mpn_bounce_in;
            transition-timing-function: ease-in
        }

        .fb_mpn_mobile_bounce_out {
            animation-duration: 300ms;
            animation-name: fb_mpn_bounce_out;
            transition-timing-function: ease-in
        }

        .fb_mpn_mobile_bounce_out_v2 {
            animation-duration: 300ms;
            animation-name: fb_mpn_fade_out;
            transition-timing-function: ease-in
        }

        .fb_customer_chat_bounce_in_v2 {
            animation-duration: 300ms;
            animation-name: fb_bounce_in_v2;
            transition-timing-function: ease-in
        }

        .fb_customer_chat_bounce_in_from_left {
            animation-duration: 300ms;
            animation-name: fb_bounce_in_from_left;
            transition-timing-function: ease-in
        }

        .fb_customer_chat_bounce_out_v2 {
            animation-duration: 300ms;
            animation-name: fb_bounce_out_v2;
            transition-timing-function: ease-in
        }

        .fb_customer_chat_bounce_out_from_left {
            animation-duration: 300ms;
            animation-name: fb_bounce_out_from_left;
            transition-timing-function: ease-in
        }

        .fb_invisible_flow {
            display: inherit;
            height: 0;
            overflow-x: hidden;
            width: 0
        }

        @keyframes fb_mpn_landing_page_slide_out {
            0% {
                margin: 0 12px;
                width: 100% - 24px
            }

            60% {
                border-radius: 18px
            }

            100% {
                border-radius: 50%;
                margin: 0 24px;
                width: 60px
            }
        }

        @keyframes fb_mpn_landing_page_slide_out_from_left {
            0% {
                left: 12px;
                width: 100% - 24px
            }

            60% {
                border-radius: 18px
            }

            100% {
                border-radius: 50%;
                left: 12px;
                width: 60px
            }
        }

        @keyframes fb_mpn_landing_page_slide_up {
            0% {
                bottom: 0;
                opacity: 0
            }

            100% {
                bottom: 24px;
                opacity: 1
            }
        }

        @keyframes fb_mpn_bounce_in {
            0% {
                opacity: .5;
                top: 100%
            }

            100% {
                opacity: 1;
                top: 0
            }
        }

        @keyframes fb_mpn_fade_out {
            0% {
                bottom: 30px;
                opacity: 1
            }

            100% {
                bottom: 0;
                opacity: 0
            }
        }

        @keyframes fb_mpn_bounce_out {
            0% {
                opacity: 1;
                top: 0
            }

            100% {
                opacity: .5;
                top: 100%
            }
        }

        @keyframes fb_bounce_in_v2 {
            0% {
                opacity: 0;
                transform: scale(0, 0);
                transform-origin: bottom right
            }

            50% {
                transform: scale(1.03, 1.03);
                transform-origin: bottom right
            }

            100% {
                opacity: 1;
                transform: scale(1, 1);
                transform-origin: bottom right
            }
        }

        @keyframes fb_bounce_in_from_left {
            0% {
                opacity: 0;
                transform: scale(0, 0);
                transform-origin: bottom left
            }

            50% {
                transform: scale(1.03, 1.03);
                transform-origin: bottom left
            }

            100% {
                opacity: 1;
                transform: scale(1, 1);
                transform-origin: bottom left
            }
        }

        @keyframes fb_bounce_out_v2 {
            0% {
                opacity: 1;
                transform: scale(1, 1);
                transform-origin: bottom right
            }

            100% {
                opacity: 0;
                transform: scale(0, 0);
                transform-origin: bottom right
            }
        }

        @keyframes fb_bounce_out_from_left {
            0% {
                opacity: 1;
                transform: scale(1, 1);
                transform-origin: bottom left
            }

            100% {
                opacity: 0;
                transform: scale(0, 0);
                transform-origin: bottom left
            }
        }

        @keyframes slideInFromBottom {
            0% {
                opacity: .1;
                transform: translateY(100%)
            }

            100% {
                opacity: 1;
                transform: translateY(0)
            }
        }

        @keyframes slideInFromBottomDelay {
            0% {
                opacity: 0;
                transform: translateY(100%)
            }

            97% {
                opacity: 0;
                transform: translateY(100%)
            }

            100% {
                opacity: 1;
                transform: translateY(0)
            }
        }
    </style>
    <script charset="utf-8" src="./assets/button.1c2a6e168692ffea6cc8d4efc5b6f6bc.js"></script>
</head>

<body data-new-gr-c-s-check-loaded="14.1054.0" data-gr-ext-installed="">
    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-JH92" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    '//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-JH92');</script>
    <!-- End Google Tag Manager -->

    <script src="./assets/Three.js"></script>
    <script src="./assets/Stats.js"></script>
    <script src="./assets/Detector.js"></script>
    <script src="./assets/RequestAnimationFrame.js"></script>

    <script>
        /*
         * AUTHOR: Iacopo Sassarini
         */

        if (!Detector.webgl) Detector.addGetWebGLMessage();

        var VISUALS_VISIBLE = true;

        var SCALE_FACTOR = 1500;
        var CAMERA_BOUND = 200;

        var NUM_POINTS_SUBSET = 32000;
        var NUM_SUBSETS = 7;
        var NUM_POINTS = NUM_POINTS_SUBSET * NUM_SUBSETS;

        var NUM_LEVELS = 7;
        var LEVEL_DEPTH = 600;

        var DEF_BRIGHTNESS = 1;
        var DEF_SATURATION = 0.8;

        var SPRITE_SIZE = 5;

        // Orbit parameters constraints
        var A_MIN = -30;
        var A_MAX = 30;
        var B_MIN = .2;
        var B_MAX = 1.8;
        var C_MIN = 5;
        var C_MAX = 17;
        var D_MIN = 0;
        var D_MAX = 10;
        var E_MIN = 0;
        var E_MAX = 12;

        // Orbit parameters
        var a, b, c, d, e;

        // Orbit data
        var orbit = {
            subsets: [],
            xMin: 0,
            xMax: 0,
            yMin: 0,
            yMax: 0,
            scaleX: 0,
            scaleY: 0
        }
        // Initialize data points
        for (var i = 0; i < NUM_SUBSETS; i++) {
            var subsetPoints = [];
            for (var j = 0; j < NUM_POINTS_SUBSET; j++) {
                subsetPoints[j] = {
                    x: 0,
                    y: 0,
                    vertex: new THREE.Vertex(new THREE.Vector3(0, 0, 0))
                };
            }
            orbit.subsets.push(subsetPoints);
        }

        var container, stats;
        var camera, scene, renderer, composer, hueValues = [];

        var mouseX = 0, mouseY = 0;

        var windowHalfX = window.innerWidth / 2;
        var windowHalfY = window.innerHeight / 2;

        var speed = 8;
        var rotationSpeed = 0.005;

        init();
        animate();

        function init() {

            sprite1 = THREE.ImageUtils.loadTexture("./assets/galaxy.png");

            container = document.createElement('div');
            document.body.appendChild(container);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 3 * SCALE_FACTOR);
            camera.position.z = SCALE_FACTOR / 2;

            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.0010);

            generateOrbit();

            for (var s = 0; s < NUM_SUBSETS; s++) { hueValues[s] = Math.random(); }

            // Create particle systems
            for (var k = 0; k < NUM_LEVELS; k++) {
                for (var s = 0; s < NUM_SUBSETS; s++) {

                    var geometry = new THREE.Geometry();
                    for (var i = 0; i < NUM_POINTS_SUBSET; i++) { geometry.vertices.push(orbit.subsets[s][i].vertex); }
                    var materials = new THREE.ParticleBasicMaterial({ size: (SPRITE_SIZE), map: sprite1, blending: THREE.AdditiveBlending, depthTest: false, transparent: true });
                    materials.color.setHSV(hueValues[s], DEF_SATURATION, DEF_BRIGHTNESS);


                    var particles = new THREE.ParticleSystem(geometry, materials);
                    particles.myMaterial = materials;
                    particles.myLevel = k;
                    particles.mySubset = s;
                    particles.position.x = 0;
                    particles.position.y = 0;
                    particles.position.z = - LEVEL_DEPTH * k - (s * LEVEL_DEPTH / NUM_SUBSETS) + SCALE_FACTOR / 2;
                    particles.needsUpdate = 0;
                    scene.add(particles);

                }
            }

            // Setup renderer and effects
            renderer = new THREE.WebGLRenderer({ clearColor: 0x000000, clearAlpha: 1, antialias: false });
            renderer.setSize(window.innerWidth, window.innerHeight);

            container.appendChild(renderer.domElement);

            stats = new Stats();
            stats.domElement.style.position = 'absolute';
            stats.domElement.style.top = '5px';
            stats.domElement.style.right = '5px';
            container.appendChild(stats.domElement);

            // Setup listeners
            document.addEventListener('mousemove', onDocumentMouseMove, false);
            document.addEventListener('touchstart', onDocumentTouchStart, false);
            document.addEventListener('touchmove', onDocumentTouchMove, false);
            document.addEventListener('keydown', onKeyDown, false);
            window.addEventListener('resize', onWindowResize, false);

            // Schedule orbit regeneration
            setInterval(updateOrbit, 3000);
        }

        function animate() {
            requestAnimationFrame(animate);
            render();
            stats.update();
        }

        function render() {

            if (camera.position.x >= - CAMERA_BOUND && camera.position.x <= CAMERA_BOUND) {
                camera.position.x += (mouseX - camera.position.x) * 0.05;
                if (camera.position.x < - CAMERA_BOUND) camera.position.x = -CAMERA_BOUND;
                if (camera.position.x > CAMERA_BOUND) camera.position.x = CAMERA_BOUND;
            }
            if (camera.position.y >= - CAMERA_BOUND && camera.position.y <= CAMERA_BOUND) {
                camera.position.y += (- mouseY - camera.position.y) * 0.05;
                if (camera.position.y < - CAMERA_BOUND) camera.position.y = -CAMERA_BOUND;
                if (camera.position.y > CAMERA_BOUND) camera.position.y = CAMERA_BOUND;
            }

            camera.lookAt(scene.position);

            for (i = 0; i < scene.objects.length; i++) {
                scene.objects[i].position.z += speed;
                scene.objects[i].rotation.z += rotationSpeed;
                if (scene.objects[i].position.z > camera.position.z) {
                    scene.objects[i].position.z = - (NUM_LEVELS - 1) * LEVEL_DEPTH;
                    if (scene.objects[i].needsUpdate == 1) {
                        scene.objects[i].geometry.__dirtyVertices = true;
                        scene.objects[i].myMaterial.color.setHSV(hueValues[scene.objects[i].mySubset], DEF_SATURATION, DEF_BRIGHTNESS);
                        scene.objects[i].needsUpdate = 0;
                    }
                }
            }

            renderer.render(scene, camera);
        }

        ///////////////////////////////////////////////
        // Hopalong Orbit Generator
        ///////////////////////////////////////////////         
        function updateOrbit() {
            generateOrbit();
            for (var s = 0; s < NUM_SUBSETS; s++) {
                hueValues[s] = Math.random();
            }
            for (i = 0; i < scene.objects.length; i++) {
                scene.objects[i].needsUpdate = 1;
            }

        }

        function generateOrbit() {
            var x, y, z, x1;
            var idx = 0;

            prepareOrbit();

            // Using local vars should be faster
            var al = a;
            var bl = b;
            var cl = c;
            var dl = d;
            var el = e;
            var subsets = orbit.subsets;
            var num_points_subset_l = NUM_POINTS_SUBSET;
            var num_points_l = NUM_POINTS;
            var scale_factor_l = SCALE_FACTOR;

            var xMin = 0, xMax = 0, yMin = 0, yMax = 0;
            var choice;
            choice = Math.random();

            for (var s = 0; s < NUM_SUBSETS; s++) {

                // Use a different starting point for each orbit subset
                x = s * .005 * (0.5 - Math.random());
                y = s * .005 * (0.5 - Math.random());

                var curSubset = subsets[s];

                for (var i = 0; i < num_points_subset_l; i++) {

                    // Iteration formula (generalization of the Barry Martin's original one)


                    if (choice < 0.5) {
                        z = (dl + (Math.sqrt(Math.abs(bl * x - cl))));
                    }
                    else if (choice < 0.75) {
                        z = (dl + Math.sqrt(Math.sqrt(Math.abs(bl * x - cl))));

                    }
                    else {
                        z = (dl + Math.log(2 + Math.sqrt(Math.abs(bl * x - cl))));
                    }

                    if (x > 0) { x1 = y - z; }
                    else if (x == 0) { x1 = y; }
                    else { x1 = y + z; }
                    y = al - x;
                    x = x1 + el;

                    curSubset[i].x = x;
                    curSubset[i].y = y;

                    if (x < xMin) { xMin = x; }
                    else if (x > xMax) { xMax = x; }
                    if (y < yMin) { yMin = y; }
                    else if (y > yMax) { yMax = y; }

                    idx++;
                }
            }

            var scaleX = 2 * scale_factor_l / (xMax - xMin);
            var scaleY = 2 * scale_factor_l / (yMax - yMin);

            orbit.xMin = xMin;
            orbit.xMax = xMax;
            orbit.yMin = yMin;
            orbit.yMax = yMax;
            orbit.scaleX = scaleX;
            orbit.scaleY = scaleY;

            // Normalize and update vertex data             
            for (var s = 0; s < NUM_SUBSETS; s++) {
                var curSubset = subsets[s];
                for (var i = 0; i < num_points_subset_l; i++) {
                    curSubset[i].vertex.position.x = scaleX * (curSubset[i].x - xMin) - scale_factor_l;
                    curSubset[i].vertex.position.y = scaleY * (curSubset[i].y - yMin) - scale_factor_l;
                }
            }
        }

        function prepareOrbit() {
            shuffleParams();
            orbit.xMin = 0;
            orbit.xMax = 0;
            orbit.yMin = 0;
            orbit.yMax = 0;
        }

        function shuffleParams() {
            a = A_MIN + Math.random() * (A_MAX - A_MIN);
            b = B_MIN + Math.random() * (B_MAX - B_MIN);
            c = C_MIN + Math.random() * (C_MAX - C_MIN);
            d = D_MIN + Math.random() * (D_MAX - D_MIN);
            e = E_MIN + Math.random() * (E_MAX - E_MIN);
        }

        ///////////////////////////////////////////////
        // Event listeners
        ///////////////////////////////////////////////
        function onDocumentMouseMove(event) {
            mouseX = event.clientX - windowHalfX;
            mouseY = event.clientY - windowHalfY;
        }

        function onDocumentTouchStart(event) {
            if (event.touches.length == 1) {
                event.preventDefault();
                mouseX = event.touches[0].pageX - windowHalfX;
                mouseY = event.touches[0].pageY - windowHalfY;
            }
        }

        function onDocumentTouchMove(event) {
            if (event.touches.length == 1) {
                event.preventDefault();
                mouseX = event.touches[0].pageX - windowHalfX;
                mouseY = event.touches[0].pageY - windowHalfY;
            }
        }

        function onWindowResize(event) {
            windowHalfX = window.innerWidth / 2;
            windowHalfY = window.innerHeight / 2;
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onKeyDown(event) {
            if (event.keyCode == 38 && speed < 20) speed += .5;
            else if (event.keyCode == 40 && speed > 0) speed -= .5;
            else if (event.keyCode == 37) rotationSpeed += .001;
            else if (event.keyCode == 39) rotationSpeed -= .001;
            else if (event.keyCode == 72 || event.keyCode == 104) toggleVisuals();
        }

        function showHideAbout() {
            if (document.getElementById('about').style.display == "block") {
                document.getElementById('about').style.display = "none";
            } else {
                document.getElementById('about').style.display = "block";
            }
        }

        function toggleVisuals() {
            if (VISUALS_VISIBLE) {
                document.getElementById('plusone').style.display = 'none';
                document.getElementById('tweet').style.display = 'none';
                document.getElementById('fb').style.display = 'none';
                document.getElementById('aboutlink').style.display = 'none';
                document.getElementById('about').style.display = 'none';
                document.getElementById('info').style.display = 'none';
                document.getElementById('chaosnebula').style.display = 'none';
                stats.domElement.style.display = 'none';
                renderer.domElement.style.cursor = "none";
                VISUALS_VISIBLE = false;
            }
            else {
                document.getElementById('plusone').style.display = 'block';
                document.getElementById('tweet').style.display = 'block';
                document.getElementById('fb').style.display = 'block';
                document.getElementById('aboutlink').style.display = 'block';
                document.getElementById('info').style.display = 'block';
                document.getElementById('chaosnebula').style.display = 'block';
                stats.domElement.style.display = 'block';
                renderer.domElement.style.cursor = "";
                VISUALS_VISIBLE = true;
            }
        }
    </script>
    <div><canvas width="620" height="707"></canvas>
        <div
            style="cursor: pointer; width: 80px; opacity: 0.9; z-index: 10001; position: absolute; top: 5px; right: 5px;">
            <div style="background-color: rgb(8, 8, 24); padding: 2px 0px 3px;">
                <div
                    style="font-family: Helvetica, Arial, sans-serif; text-align: left; font-size: 9px; color: rgb(0, 255, 255); margin: 0px 0px 1px 3px;">
                    <span style="font-weight:bold">44 FPS</span> (32-61)</div><canvas width="74" height="30"
                    style="display: block; margin-left: 3px;"></canvas>
            </div>
            <div style="background-color: rgb(8, 24, 8); padding: 2px 0px 3px; display: none;">
                <div
                    style="font-family: Helvetica, Arial, sans-serif; text-align: left; font-size: 9px; color: rgb(0, 255, 0); margin: 0px 0px 1px 3px;">
                    <span style="font-weight:bold">17 MS</span> (1-265)</div><canvas width="74" height="30"
                    style="display: block; margin-left: 3px;"></canvas>
            </div>
            <div style="background-color: rgb(24, 8, 13); padding: 2px 0px 3px; display: none;">
                <div
                    style="font-family: Helvetica, Arial, sans-serif; text-align: left; font-size: 9px; color: rgb(255, 0, 128); margin: 0px 0px 1px 3px;">
                    <span style="font-weight:bold">80 MB</span> (79-87)</div><canvas width="74" height="30"
                    style="display: block; margin-left: 3px;"></canvas>
            </div>
        </div>
    </div>

    <div id="fb-root" class=" fb_reset">
        <div style="position: absolute; top: -10000px; width: 0px; height: 0px;">
            <div></div>
        </div>
    </div>
    <script>(function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) { return; }
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script>

    <div id="info">Barry Martin's Hopalong Orbits Visualizer - Created using <a href="http://github.com/mrdoob/three.js"
            target="_blank">three.js</a>
        <br> [Mouse Move] Change camera position
        <br> [Up-Down] Change speed - [Left-Right] Change rotation
        <br> [H] Toggle info and cursor - [F11] Toggle fullscreen
    </div>
    <div id="aboutlink">
        <a href="javascript:showHideAbout()">About</a>
    </div>

    <div id="about">
        <b>Barry Martin's Hopalong Orbits Visualizer</b>
        <p>These orbits are generated iterating this simple formula:</p>
        <p>(x, y) -&gt; (y - sign(x)*sqrt(abs(b*x - c)), a -x )</p>
        <p>where a, b, c are random parameters. This is known as the 'Hopalong Attractor'.</p>
        <p>3D rendering is done using WebGL and <a href="http://github.com/mrdoob/three.js" target="_blank">three.js</a>
        </p>
        <hr>
        This is a <a href="http://www.chromeexperiments.com/detail/webgl-attractors-trip/?f="
            onclick="recordOutboundLink(this, &#39;Outbound Links&#39;, &#39;chromeexperiments.com&#39;);return false;">
            Chrome Experiment</a>
    </div>

    <div id="fb">
        <div style="position:relative; top:0px;" class="fb-like fb_iframe_widget"
            data-href="http://iacopoapps.appspot.com/hopalongwebgl/" data-send="false" data-layout="button_count"
            data-width="450" data-show-faces="true" data-colorscheme="dark" fb-xfbml-state="rendered"
            fb-iframe-plugin-query="app_id=&amp;color_scheme=dark&amp;container_width=0&amp;href=http%3A%2F%2Fiacopoapps.appspot.com%2Fhopalongwebgl%2F&amp;layout=button_count&amp;locale=en_US&amp;sdk=joey&amp;send=false&amp;show_faces=true&amp;width=450">
            <span style="vertical-align: top; width: 0px; height: 0px; overflow: hidden;"><iframe name="f3f7feac31167a4"
                    width="450px" height="1000px" data-testid="fb:like Facebook Social Plugin"
                    title="fb:like Facebook Social Plugin" frameborder="0" allowtransparency="true"
                    allowfullscreen="true" scrolling="no" allow="encrypted-media" src="./assets/like.html"
                    style="border: none; visibility: visible; width: 0px; height: 0px;"></iframe></span></div>
    </div>
    <div id="tweet">
        <iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true"
            class="twitter-share-button twitter-share-button-rendered twitter-tweet-button"
            style="position: static; visibility: visible; width: 73px; height: 20px;" title="Twitter Tweet Button"
            src="./assets/tweet_button.a58e82e150afc25eb5372dd55a98b778.en.html"></iframe>
        <script type="text/javascript" src="./assets/widgets.js"></script>
    </div>

    <div id="chaosnebula">
    </div>


    <iframe scrolling="no" frameborder="0" allowtransparency="true"
        src="./assets/widget_iframe.a58e82e150afc25eb5372dd55a98b778.html" title="Twitter settings iframe"
        style="display: none;"></iframe><iframe id="rufous-sandbox" scrolling="no" frameborder="0"
        allowtransparency="true" allowfullscreen="true"
        style="position: absolute; visibility: hidden; display: none; width: 0px; height: 0px; padding: 0px; border: none;"
        title="Twitter analytics iframe" src="./assets/saved_resource.html"></iframe>
</body>
<grammarly-desktop-integration data-grammarly-shadow-root="true"></grammarly-desktop-integration>

</html>